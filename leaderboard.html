<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spot On! Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --carolina-blue: #7BAFD4;
            --carolina-light: #a8d1f0;
            --bg-dark: #1a1a1a;
            --bg-card: #2a2a2a;
            --text-primary: #ffffff;
            --text-muted: #9ca3af;
            --border-color: #444444;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .glow {
            text-shadow: 0 0 15px var(--carolina-blue);
        }
        
        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-muted);
        }
        .filter-btn:hover {
            border-color: var(--carolina-blue);
            color: var(--text-primary);
        }
        .filter-btn.active {
            background: var(--carolina-blue);
            border-color: var(--carolina-blue);
            color: var(--bg-dark);
            font-weight: 600;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }
        .leaderboard-table th {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 2px solid var(--border-color);
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .leaderboard-table td {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .leaderboard-table tr:hover {
            background: rgba(123, 175, 212, 0.05);
        }
        
        .rank-1 { color: #fbbf24; font-weight: 700; }
        .rank-2 { color: #9ca3af; font-weight: 700; }
        .rank-3 { color: #cd7f32; font-weight: 700; }
        
        .score-value {
            font-weight: 700;
            color: var(--carolina-blue);
            font-size: 18px;
        }
        
        .game-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .game-sweet-spot { background: rgba(123, 175, 212, 0.2); color: var(--carolina-blue); }
        .game-find-the-center { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .game-perfect-alignment { background: rgba(52, 211, 153, 0.2); color: #34d399; }
        .game-balanced-placement { background: rgba(167, 139, 250, 0.2); color: #a78bfa; }
        .game-picture-perfect { background: rgba(251, 113, 133, 0.2); color: #fb7185; }
        
        .back-link {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: color 0.2s;
        }
        .back-link:hover {
            color: var(--carolina-blue);
        }
    </style>
</head>
<body>
    <div class="min-h-screen">
        <!-- Header -->
        <header class="border-b border-gray-800 py-4 px-6">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <a href="index.html" class="back-link">‚Üê Back to Games</a>
                <h1 class="text-xl font-bold glow" style="color: var(--carolina-blue);">SPOT ON!</h1>
                <div style="width: 120px;"></div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="max-w-4xl mx-auto p-6">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold mb-2">üèÜ Leaderboard</h2>
                <p class="text-gray-400">Top scores across all games</p>
            </div>
            
            <!-- Game Filters -->
            <div class="flex flex-wrap gap-2 justify-center mb-6">
                <button class="filter-btn active" data-game="all">All Games</button>
                <button class="filter-btn" data-game="sweet-spot">Sweet Spot</button>
                <button class="filter-btn" data-game="find-the-center">Find the Center</button>
                <button class="filter-btn" data-game="perfect-alignment">Perfect Alignment</button>
                <button class="filter-btn" data-game="balanced-placement">Balanced Placement</button>
                <button class="filter-btn" data-game="picture-perfect">Picture Perfect</button>
            </div>
            
            <!-- Leaderboard Table -->
            <div class="panel overflow-hidden">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">Rank</th>
                            <th>Player</th>
                            <th>Game</th>
                            <th style="text-align: right;">Score</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr>
                            <td colspan="4" class="text-center py-8 text-gray-500">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <p id="scoreCount" class="text-center text-gray-500 text-sm mt-4"></p>
        </main>
        
        <!-- Footer -->
        <footer class="text-center py-6 text-gray-600 text-sm">
            <p>Spot On! Perception Games</p>
        </footer>
    </div>

    <script src="firebase-config.js"></script>
    <script>
        let db;
        let allScores = [];
        let currentFilter = 'all';
        
        const GAME_NAMES = {
            'sweet-spot': 'Sweet Spot',
            'find-the-center': 'Find the Center',
            'perfect-alignment': 'Perfect Alignment',
            'balanced-placement': 'Balanced Placement',
            'picture-perfect': 'Picture Perfect'
        };
        
        const GAME_CLASSES = {
            'sweet-spot': 'game-sweet-spot',
            'find-the-center': 'game-find-the-center',
            'perfect-alignment': 'game-perfect-alignment',
            'balanced-placement': 'game-balanced-placement',
            'picture-perfect': 'game-picture-perfect'
        };
        
        async function initFirebase() {
            try {
                if (typeof firebaseConfig === 'undefined') {
                    showError('Firebase config not found');
                    return;
                }
                
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                await loadScores();
            } catch (error) {
                console.error('Firebase init error:', error);
                showError('Failed to connect to database');
            }
        }
        
        async function loadScores() {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-500">Loading...</td></tr>';
            
            try {
                const snapshot = await db.collection('scores')
                    .orderBy('score', 'desc')
                    .limit(100)
                    .get();
                
                allScores = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderScores();
            } catch (error) {
                console.error('Load scores error:', error);
                showError('Failed to load scores');
            }
        }
        
        function renderScores() {
            const tbody = document.getElementById('leaderboardBody');
            const countEl = document.getElementById('scoreCount');
            
            // Filter scores
            let filtered = allScores;
            if (currentFilter !== 'all') {
                filtered = allScores.filter(s => s.gameId === currentFilter);
            }
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-500">No scores yet. Be the first!</td></tr>';
                countEl.textContent = '';
                return;
            }
            
            tbody.innerHTML = filtered.map((score, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                const gameName = GAME_NAMES[score.gameId] || score.gameId;
                const gameClass = GAME_CLASSES[score.gameId] || 'game-sweet-spot';
                
                return `
                    <tr>
                        <td class="${rankClass}">#${rank}</td>
                        <td class="font-semibold">${escapeHtml(score.initials || '???')}</td>
                        <td><span class="game-badge ${gameClass}">${escapeHtml(gameName)}</span></td>
                        <td class="text-right score-value">${score.score}</td>
                    </tr>
                `;
            }).join('');
            
            countEl.textContent = `Showing ${filtered.length} scores`;
        }
        
        function showError(message) {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-red-400">${escapeHtml(message)}</td></tr>`;
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Filter button handlers
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.game;
                renderScores();
            });
        });
        
        // Init
        initFirebase();
    </script>
</body>
</html>
